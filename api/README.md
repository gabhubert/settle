# API

# Account creation and key management

Settl only stores encrypted version of the keys associated with a user account.
User creation involves the following steps:

```
- (client-side) generate a keypair (p_A, k_A)
- (client-side) encrypt the private key using scrypt with password pw_A:
  e_A = k_A XOR scrypt(pw_A, p_A)
- (client-side) submit username u_A, p_A, e_A to server and sign the request
  using the private key
- (server) create user and store e_A, p_A and u_A
```

# Authentication

Each request is signed using the user private key, including a non-reusable
token (random string) that becomes uniquely associated with the request. Tokens
are generated by the API and the free tokens can be retrieved using the
following endpoint. They are valid for 5mn.
```
curl -XGET settl.net/tokens?count=2
{
 "tokens": [
    {
      "id": "1463699742482_CoHtHxmKDArtyJdg:XaQhCZumkpGrIgKMD6GNR+...",
      "created": 1463699742482,
      "expires_at": 1463700042482
    },
    {
      "id": "1463699742482_x92krP3Nl0uaVOQL:VpguS4+k+uZP6DuxORFic+...",
      "created": 1463699742482,
      "expires_at": 1463700042482
    }
  ]
}
```

When performing a request, a free token must be specified. Basic authentication
is then used, using the public key as username and the signature as password.


```
curl -XPOST settl.net/stellar/operations
  -u $address:$signature
  -d token=1oeiwqlkdj_1231230123_djlkqdj13j123
  -d type={payment, path_payment, manager_offer}
  -d destination=alistair*settl.net
  -d asset=usd
  -d amount=5

{
  operation: {
    id: "operation_k23hj2o2mlkno",
    type: "payment",
    status: "pending",
    token: "1463699742482_x92krP3Nl0uaVOQL:VpguS4+k+uZP6DuxORFic+...",
    destination: "alistair*settl.net",
    amount: 5,
    asset: "usd",
    transaction: "ASDVASD/ASdsa..."
  }
}
```

# API reference

## Account creation

```
curl -XPOST settl.net/users
  -H $address:$signature
  -d token="1463699742482_x92krP3Nl0uaVOQL:VpguS4+k+uZP6DuxORFic+..."
  -d username=stan
  -d address=ABASD...
  -d encrypted_seed=ASDA...
```

## Stellar Operations

```
curl -XPOST settl.net/stellar/operations
  -H $address:$signature
  -d token=1oeiwqlkdj_1231230123_djlkqdj13j123
  -d type={payment, path_payment, manager_offer}
  -d destination=alistair*settl.net
  -d asset=usd
  -d amount=5

{
  operation: {
    id: "operation_k23hj2o2mlkno",
    type: "payment",
    status: "pending",
    token: "1oeiwqlkdj_1231230123_djlkqdj13j123",
    destination: "alistair*settl.net",
    amount: 5,
    asset: "usd",
    transaction: "ASDVASD/ASdsa..."
  }
}

```

```
curl -XPOST settl.net/stellar/operations/operation_k23hj2o2mlkno/submit
  -H $address:$signature
  -d token=1oeiwqlkdj_1231230123_k2jt329jpfldfas
  -d envelope="ADWQ/khj21e..."
```

```
curl -XGET settl.net/stellar/operations
```
